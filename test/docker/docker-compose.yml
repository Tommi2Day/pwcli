name: pwcli
services:
  ldap:
    image: "${VENDOR_IMAGE_PREFIX}docker.io/cleanstart/openldap:2.6.10"
    restart: "no"
    hostname: "ldap.example.local"
    ports:
      - '1389:389'
      - '1636:636'
    volumes:
      - "./ldap/ldif:/ldif:ro"
      - "./ldap/certs:/certs:ro"
      - "./ldap/etc/slapd.conf:/etc/openldap/slapd.conf:ro"

  kms:
    image: "${VENDOR_IMAGE_PREFIX}docker.io/nsmithuk/local-kms:3.12.0"
    volumes:
      - ./kms/init:/init
      - ./kms/data:/data
    ports:
      - "18080:8080"
    environment:
      - PORT=8080
      - KMS_ACCOUNT_ID=111122223333
      - KMS_REGION=eu-central-1
      - KMS_SEED_PATH=/init/seed.yaml
      - KMS_DATA_PATH=/data

  vault:
    image: "${VENDOR_IMAGE_PREFIX}docker.io/hashicorp/vault:1.19.0"
    restart: "no"
    ports:
      - '18200:8200'
    environment:
      - VAULT_DEV_ROOT_TOKEN_ID=pwcli-test
      - VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200
    cap_add:
      - IPC_LOCK